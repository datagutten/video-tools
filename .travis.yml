language: php

jobs:
   include:
      -  os: windows
         language: shell
         before_install:
            - choco config set cacheLocation $HOME/choco_cache
            - choco install --no-progress tests/packages.config
            - wget -O ffmpeg.7z https://www.gyan.dev/ffmpeg/builds/ffmpeg-release-full.7z
            - 7z e ffmpeg.7z *.exe -r
            - mv *.exe /c/tools/
            - cp $TRAVIS_BUILD_DIR/tests/windows_files/* $SYSTEMROOT/system32
            - export PATH="/c/tools/php80:/c/tools:/c/ProgramData/ComposerSetup/bin/:$PATH"
            - wget -q -O /c/tools/php80/php.ini https://raw.githubusercontent.com/datagutten/tools/master/tests/php-test.ini
         install:
            - composer install --no-interaction
         cache:
            directories:
               - $LOCALAPPDATA/Composer/files
               - $TRAVIS_BUILD_DIR/tests/test_data
               - $HOME/choco_cache
      -  os: linux
         php: '7.1'
      -  php: '7.2'
      -  php: '7.3'
      -  php: '7.4'
      -  php: '8.0'
      -  php: 'nightly'
      -  php: '7.4'
         name: 'Prefer lowest'
         install:
            - composer install --no-interaction
            - composer update --prefer-lowest

   allow_failures:
      -  php: 'nightly'

addons:
   apt:
      packages:
         - ffmpeg
         - mediainfo

env:
   global:
      - XDEBUG_MODE=coverage

cache:
   directories:
      - $HOME/.cache/composer/files
      - $TRAVIS_BUILD_DIR/tests/test_data

before_install:
   - bash -c 'echo $TRAVIS_OS_NAME'

install:
   - composer install --no-interaction;

before_script:
   - vendor/bin/phpunit --version

script:
   - vendor/bin/phpunit

after_script:
  - bash <(curl -s https://codecov.io/bash)